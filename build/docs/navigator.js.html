<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/js/angular/synapp/controllers/navigator.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/js/angular/synapp/controllers/navigator.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *  Navigator Controller (`NavigatorCtrl`)
 *  ======================================
 *
 *  Controls the navigation and three-way binds items.
 *
 *  ## Type lineage
 *
 *  Navigator shows items grouped by type lineage. 
 *  
 *  - Topics
 *    - Problems
 *      - Opinions
 *      - Solutions
 *        - Opinions
 *
 *
 *  ## Loading data flow
 *
 *  Navigator works by lazy loading. It does not load data until a User Event triggers it to do so. The only exception to that are topics that gets downloaded on `ng-init`
 *
 *  Data loads a default batch of 15 items with the option of loading more via User Event. Every batch downloaded stays in the Memory.
 *
 *  The function used to fetch data is {@link getTopics}.
 *
 *  ## Bootstrap
 *  
 *  We use {@link http://getbootstrap.com/javascript/#collapse| Bootstrap collapse} to expand/squeeze items and sub-items
 *
 *  ### Bootstrap integration in Scope
 *
 *  The controller listen to Bootstrap's collapse `show` and `hide` events and calls either {@link module:controllers/navigator~onCollapse} or {@link module:controllers/navigator~onCollapse}.
 * 
 *  @module controllers/navigator
 *  @prop $scope {k} - Controller's scope
 *  @prop $scope.topics {NavigatorItem[]} - Array of topics
 *  @see {@link https://docs.angularjs.org/guide/controller| Angular Documentation: Controller}
 *  @see {@link https://docs.angularjs.org/api/ng/directive/ngController| Angular Documentation: ngController}
 *  @see {@link https://docs.angularjs.org/api/ng/service/$timeout| Angular Documentation: $timeout}
 *  @see {@link http://getbootstrap.com/javascript/#collapse| Bootstrap Documentation: collapse}
 *  @example
 *    &lt;ANY ng-controller="NavigatorCtrl" ng-init="getTopics()" />
 *  @todo Possible memory leaks with all the batch of items being kept in the Memory. Maybe defining a maximum of items?
 * @author francoisrvespa@gmail.com
*/

module.exports = function NavigatorCtrl ($scope, DataFactory, $timeout) {
  'use strict';

  var Topic = DataFactory.Topic,
    Problem = DataFactory.Problem;

  /** @function 
   *  @param {Object} evt - DOM Event
   */

  function onCollapse (evt) {

    var target = $(event.target).closest('.box'),
      targetScope = angular.element(target).scope();

    targetScope.$apply(function () {
        targetScope.$showButtons = false;
      });
  }

  /** @function 
   *  @param {Object} evt - DOM Event
   */

  function onExpand (evt) {
    /** Get item's info */

    var target = $(event.target).closest('.box'),
      targetScope = angular.element(target).scope();

    if ( ! targetScope.$type ) {
      ['topic', 'problem'].forEach(function (type) {
        if ( type in targetScope ) {
          targetScope.$type = type;
        }
      });
    }

    if ( ! targetScope.$loaded ) {
      switch ( targetScope.$type ) {
        case 'topic':
          Problem.get(targetScope[targetScope.$type]._id)

            .success(function (problems) {
              targetScope.$showButtons  =   true;
              targetScope.$loaded       =   true;
              targetScope.$problems     =   problems;
            });
          break;
        }
    }

    else {
      targetScope.$apply(function () {
        targetScope.$showButtons = true;
      });
    }

    return console.log(targetScope);
  }

  /** Function to add listeners to Bootstrap collapse's events
   *  This function gets called upon success of {@link getTopics}
   *  @function onLoaded
   */

  function onLoaded () {
    $('.navigator .collapse')
      .on('show.bs.collapse', onExpand)
      .on('hide.bs.collapse', onCollapse);
  }

  /** @function getTopics */

  function getTopics () {
    Topic.get()
      .success(function (topics) {

        $scope.topics = topics;

        $timeout(onLoaded);
      });
  }

  $scope.getTopics = getTopics;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="details.html">controllers/details</a></li><li><a href="editor.html">controllers/editor</a></li><li><a href="evaluator.html">controllers/evaluator</a></li><li><a href="navigator.html">controllers/navigator</a></li><li><a href="charts.html">directives/charts</a></li><li><a href="more-less.html">directives/more-less</a></li><li><a href="cloudinary-transform.html">filters/cloudinary-transform</a></li><li><a href="from-now.html">filters/from-now</a></li><li><a href="get-currently-evaluated.html">filters/get-currently-evaluated</a></li><li><a href="shorten.html">filters/shorten</a></li><li><a href="module-synapp.html">synapp</a></li></ul><h3>class</h3><ul><li><a href="CriteriaSchema.html">CriteriaSchema</a></li><li><a href="FeedbackSchema.html">FeedbackSchema</a></li><li><a href="ItemSchema.html">ItemSchema</a></li><li><a href="UserSchema.html">UserSchema</a></li><li><a href="VoteSchema.html">VoteSchema</a></li></ul><h3>Global</h3><ul><li><a href="global.html#controller::sign">controller::sign</a></li><li><a href="global.html#controller::upload">controller::upload</a></li><li><a href="global.html#directive::get-url-title">directive::get-url-title</a></li><li><a href="global.html#directive::sliders">directive::sliders</a></li><li><a href="global.html#factory::data">factory::data</a></li><li><a href="global.html#factory::user">factory::user</a></li><li><a href="global.html#filter::get-promoted-percentage">filter::get-promoted-percentage</a></li><li><a href="global.html#model::Vote::get-accumulation">model::Vote::get-accumulation</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> 
    using <a href="https://github.com/allenhwkim/angularjs-google-maps/tree/master/config/jsdoc/template">custom template </a> and 
    <a href="https://raw.githubusercontent.com/allenhwkim/angularjs-google-maps/master/config/jsdoc/plugins/angular.js">custom tag @ngdoc</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script>
  var href=window.location.href.match(/\/([^\/]+$)/)[1];
  document.querySelector("nav a[href='"+href+"']").scrollIntoView(true);
  if (window.location.hash == "")
    document.querySelector("body").scrollIntoView(true);
</script>
</body>
</html>
