include ../mixins/bootstrap
include ../mixins/item-image

div(data-ng-init='show = "items"')
  +bootstrap-panel
    +bootstrap-panel-heading
      i.pull-right.fa.fa-plus.cursor-pointer(ng-click='show = (show === "creator" && "items") || "creator"')

      //- span(ng-click='$root.showPanel({ parent: parent, type: type }, "creator")')

      // TYPE

      h4.panel-title(data-ng-bind='type')

    +bootstrap-panel-body

      // CREATOR

      .creator.animate-show(ng-show='show === "creator"' data-type="{{ type }}" data-parent='{{ parent }}')

      // ITEMS

      .row(data-ng-hide='$root.loadedItems[item.parent || "Topic"]')
        .col-xs-12.text-center.padding Loading items...

      .row(data-ng-hide='($root.items | filterItems:type:parent).length')
        .col-xs-12.text-center.padding Nothing here!
      
      .items(ng-repeat='item in $root.items | filterItems:type:parent track by item._id')

        .item(id='item-{{item._id}}')

          // BOX
          
          .box
            .row
              .col-xs-12.padding(data-ng-class='{ "col-sm-4": ! isSplit }')
                span(ng-bind='isSplit')
                +item-image()
              .col-xs-12.padding(data-ng-class='{ "col-sm-8": ! isSplit }')
                .box-promoted(data-ng-class='{ "text-right pull-right": ! isSplit, "is-split": isSplit }')
                  .row
                    div(data-ng-show='is.in = ' + !!isSignedIn
                      data-ng-class='{ "col-xs-4": isSplit, "col-xs-12": ! isSplit}')
                      a.btn.btn-sm(data-ng-click='$show = (($show === "evaluator" && "-") || "evaluator"); $parent.show = "items"; $root.itemViewed = item._id') Promote

                    //- Promoted stat (times)
                    div(data-ng-bind='item.promotions'
                      data-ng-class='{ "col-xs-2": isSplit, "col-xs-12": ! isSplit}')

                    //- Promoted stat (percent)
                    div(data-ng-bind='(item | calculatePromotionPercentage) || 0 + "%"'
                      data-ng-class='{ "col-xs-2": isSplit, "col-xs-12": ! isSplit}')

                    //- Details button
                    div(data-ng-class='{ "col-xs-4": isSplit, "col-xs-12": ! isSplit}')
                      a.btn.btn-sm(data-ng-click='$show = (($show === "details" && "-") || "details"); $parent.show = "items"; $root.itemViewed = item._id') &nbsp;Details&nbsp;
                h4(ng-bind='item.subject')
                div.box-description.pre-text(ng-bind='item.description')
                include navigator/references

          // COLLAPSERS

          .collapsers

            // EVALUATOR
            
            .evaluator.animate-show.padding(ng-show='$show === "evaluator" && show === "items" && $root.itemViewed === item._id')
              section(ng-repeat='evaluation in $root.evaluations | getEvaluationByItem:item._id')
                
                //- 1 of 5

                .row
                  .col-xs-12.padding
                    h2.text-center
                      span(data-ng-bind='evaluation.cursor')
                      span  of  
                      span(data-ng-bind='evaluation.limit')

                // Normal screen

                section.hidden-xs
                  // Image

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      +item-image

                  // Subject

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      h2(data-ng-bind='item.subject')

                  // Description

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      .pre-text.entry-description(data-ng-bind='item.description')

                  // References

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      include navigator/references

                  // Sliders

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      .sliders

                  // Feedback

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      textarea.feedback-entry.form-control(
                        placeholder       =   'Can you provide feedback that would encourage the author to create a statement that more people would unite around?',
                        data-ng-show      =   'item.subject')

                  // Promote

                  .row.padding-bottom
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      button.btn.btn-block(
                        data-ng-click   =   'promote($index)'
                        data-ng-show    =   'evaluation.current[1]'
                      ) Promote

                // Small screen

                section.hidden-sm.hidden-md.hidden-lg(
                  data-ng-repeat      =   'item in evaluation.current'
                  )

                  // image

                  .row
                    .col-xs-12
                      +item-image

                  .row
                    .col-xs-12
                      h2(data-ng-bind='item.subject')

                  .row
                    .col-xs-12
                      .pre-text.entry-description(data-ng-bind='item.subject')

                  .row.padding-bottom
                    .col-xs-12
                      .sliders

                  .row.padding-bottom
                    .col-xs-12
                      textarea.feedback-entry.form-control(
                        placeholder       =   'Can you provide feedback that would encourage the author to create a statement that more people would unite around?',
                        data-ng-show      =   'item.subject')

                  .row.padding-bottom
                    .col-xs-12
                      button.btn.btn-block(
                        data-ng-click   =   'promote($index)'
                        data-ng-show    =   'evaluation.current[1]'
                      ) Promote

                // Continue
                .row
                  .col-sm-12
                    button.btn.btn-block(
                      data-ng-click = 'evaluation.next.length ? evaluation.continue() : finish()' 
                    )
                      span(data-ng-show='evaluation.next.length') Continue
                      span(data-ng-hide='evaluation.next.length') Finish
            
            // DETAILS

            .details.animate-show.padding(ng-show='$show === "details" && show === "items" && $root.itemViewed === item._id' ng-class=' { "active": $show === "details" && show === "items" && $root.itemViewed === item._id, "inactive": $show !== "details" || show !== "items" || $root.itemViewed !== item._id } ')
              section
                h4 Promoted
                .progress
                  .progress-bar.progress-bar-success(style='width: {{item | calculatePromotionPercentage}}%'
                    data-ng-bind='(item | calculatePromotionPercentage) + "%"')
                h4 Feedbacks
                div(data-ng-repeat='feedback in $root.feedbacks | getFeedbacksByItem:item._id')
                  div(ng-bind='feedback.feedback')
                h4 Votes

            // EDITOR

            .editor.animate-show(ng-show='$show === "editor" && show === "items" && $root.itemViewed === item._id')

            // TOGGLE ARROW

            .row.toggle-arrow
              .col-xs-12.text-center
                i.fa.cursor-pointer(ng-click='$show = (($show === "children" && "-") || "children"); $parent.show = "items"; $root.itemViewed = item._id'
                  data-ng-class='{ "fa-arrow-down": $show !== "children", "fa-arrow-up": $show === "children"}')

            // CHILDREN

            //- thereIsARelation(item._id, $root.itemViewed)

            .children.animate-show(ng-show='($root.itemHas(item, $root.itemViewed) || $root.itemViewed === item._id) && $show === "children"' data-loaded='{{false}}')
