include ../mixins/bootstrap
include ../mixins/item-image

div(data-ng-init='show = "items"')
  +bootstrap-panel
    +bootstrap-panel-heading
      i.pull-right.fa.fa-plus.cursor-pointer(ng-click='show = (show === "creator" && "items") || "creator"')

      // TYPE

      h4.panel-title(data-ng-bind='type')

    +bootstrap-panel-body
      
      // CREATOR

      .creator.animate-show(ng-show='show === "creator"' data-type="{{ type }}" data-parent='{{ parent }}')

      // ITEMS

      .row(data-ng-hide='$root.loadedItems[item.parent || "Topic"]')
        .col-xs-12.text-center.padding Loading items...

      .row(data-ng-hide='($root.items | filterItems:type:parent).length')
        .col-xs-12.text-center.padding Nothing here!
      
      .items(ng-repeat='item in $root.items | filterItems:type:parent track by item._id')

        .item(id='item-{{item._id}}')

          // BOX
          
          .box
            .row
              .col-xs-12.padding(data-ng-class='{ "col-sm-4": ! isSplit }')
                +item-image()
              .col-xs-12.padding(data-ng-class='{ "col-sm-8": ! isSplit }')
                .box-promoted(data-ng-class='{ "text-right pull-right": ! isSplit, "is-split": isSplit }')
                  .row
                    div(data-ng-show='is.in = ' + !!isSignedIn
                      data-ng-class='{ "col-xs-4": isSplit, "col-xs-12": ! isSplit}')
                      a.btn.btn-sm(data-ng-click='$show = (($show === "evaluator" && "-") || "evaluator")') Promote

                    //- Promoted stat (times)
                    div(data-ng-bind='item.promotions'
                      data-ng-class='{ "col-xs-2": isSplit, "col-xs-12": ! isSplit}')

                    //- Promoted stat (percent)
                    div(data-ng-bind='(item | calculatePromotionPercentage) || 0 + "%"'
                      data-ng-class='{ "col-xs-2": isSplit, "col-xs-12": ! isSplit}')

                    //- Details button
                    div(data-ng-class='{ "col-xs-4": isSplit, "col-xs-12": ! isSplit}')
                      a.btn.btn-sm(data-ng-click='$show = (($show === "details" && "-") || "details")') &nbsp;Details&nbsp;
                h4(ng-bind='item.subject')
                div(ng-bind='item.description')
                include navigator/references

          // COLLAPSERS

          .collapsers(ng-show='show === "items"')

            // EVALUATOR
            
            .evaluator.animate-show.padding(ng-show='$show === "evaluator"')
              section(ng-repeat='evaluation in $root.evaluations')
                
                //- 1 of 5

                .row
                  .col-xs-12.padding
                    h2.text-center
                      span(data-ng-bind='evaluation.cursor')
                      span  of  
                      span(data-ng-bind='evaluation.limit')

                section.hidden-xs
                  // Image

                  .row
                    .col-sm-6.padding(
                      data-ng-repeat      =   'item in evaluation.current'
                    )
                      +item-image

                // Continue
                .row
                  .col-sm-12
                    button.btn.btn-block(
                      data-ng-click = 'evaluation.next.length ? continue() : finish()' 
                    )
                      span(data-ng-show='evaluation.next.length') Continue
                      span(data-ng-hide='evaluation.next.length') Finish
            
            // DETAILS

            .details.animate-show.padding(ng-show='$show === "details"')
              section
                h4 Promoted
                .progress
                  .progress-bar.progress-bar-success(style='width: {{item | calculatePromotionPercentage}}%'
                    data-ng-bind='(item | calculatePromotionPercentage) + "%"')
                h4 Feedbacks
                div(data-ng-repeat='feedback in $root.feedbacks | getFeedbacksByItem:item._id')
                  div(ng-bind='feedback.feedback')

            // EDITOR

            .editor.animate-show(ng-show='$show === "editor"')

            .row
              .col-xs-12.text-center.padding-top
                i.fa.fa-arrow-down.cursor-pointer(ng-click='$show = (($show === "children" && "-") || "children")')

            // CHILDREN

            .children.animate-show(ng-show='$show === "children"' data-loaded='{{false}}')
