!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){!function(){function a(a,b,e,f,g){b.howToSend=1,b.usingFlash=c&&null!=c.upload,b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=c.html5),b.uploadRightAway=!0,b.hasUploader=function(a){return null!=b.upload[a]},b.abort=function(a){b.upload[a].abort(),b.upload[a]=null},b.onFileSelect=function(c){if(b.selectedFiles=[],b.progress=[],b.upload&&b.upload.length>0)for(var d=0;d<b.upload.length;d++)null!=b.upload[d]&&b.upload[d].abort();b.upload=[],b.uploadResult=[],a.uploadResult=b.uploadResult,b.selectedFiles=c,b.dataUrls=[],a.dataUrls=b.dataUrls;for(var d=0;d<c.length;d++){var e=c[d];if(b.fileReaderSupported&&e.type.indexOf("image")>-1){var g=new FileReader;g.readAsDataURL(c[d]);{(function(a,c){a.onload=function(a){f(function(){b.dataUrls[c]=a.target.result})}})(g,d)}}b.progress[d]=-1,b.uploadRightAway&&b.start(d)}},b.start=function(a){if(b.progress[a]=0,b.errorMsg=null,1==b.howToSend)b.upload[a]=g.upload({url:d,method:b.httpMethod,headers:{"my-header":"my-header-value"},data:{myModel:b.myModel},file:b.selectedFiles[a],fileFormDataName:"myFile"}),b.upload[a].then(function(a){f(function(){b.uploadResult.push(a.data)})},function(a){a.status>0&&(b.errorMsg=a.status+": "+a.data)},function(c){b.progress[a]=Math.min(100,parseInt(100*c.loaded/c.total))}),b.upload[a].xhr(function(a){a.upload.addEventListener("abort",function(){console.log("abort complete")},!1)});else{var c=new FileReader;c.onload=function(c){b.upload[a]=g.http({url:d,headers:{"Content-Type":b.selectedFiles[a].type},data:c.target.result}).then(function(a){b.uploadResult.push(a.data)},function(a){a.status>0&&(b.errorMsg=a.status+": "+a.data)},function(c){b.progress[a]=Math.min(100,parseInt(100*c.loaded/c.total))})},c.readAsArrayBuffer(b.selectedFiles[a])}},b.dragOverClass=function(a){var b=a.dataTransfer.items,c=!1;if(null!=b){for(var d=0;d<b.length;d++)if("file"==b[d].kind){c=!0;break}}else c=!0;return c?"dragover":"dragover-err"}}var c={debug:!0},d="/tools/upload";window.uploadUrl=window.uploadUrl||"upload",b.exports=["$rootScope","$scope","$http","$timeout","$upload",a]}()},{}],2:[function(a,b){!function(){function a(a){return{restrict:"CA",link:function(b,c){var d=b.$parent.item._id,e=b.criteria._id,f=!1;b.$root.$watch("votes",function(g){if(g&&g.length&&!f)if(f=!0,g=g.filter(function(a){return a.item===d}),g.length&&g[0].criterias[e]){var h=$('<svg class="chart"></svg>');h.attr("id","chart-"+b.item._id+"-"+b.criteria._id),c.empty().append(h);var i=[];for(var j in g[0].criterias[e].values)i.push({label:"number",value:100*g[0].criterias[e].values[j]/g[0].criterias[e].total});var k=["votes"];i.forEach(function(a){k.push(a.value)}),console.log("columns",k);{c3.generate({bindto:"#"+c.find("svg").attr("id"),data:{x:"x",columns:[["x",-1,0,1],k],type:"bar"},grid:{x:{lines:3}},axis:{x:{},y:{max:90,show:!1,tick:{count:5,format:function(a){return a}}}},size:{height:80},bar:{width:$(window).width()/5}})}a(function(){c.find(".c3-chart-bar:first").hide()})}else c.find("svg").css("height","0")})}}}b.exports=["$timeout",a]}()},{}],3:[function(a,b){!function(){function a(a,b,c){return{restrict:"C",templateUrl:"/templates/editor",scope:{type:"@",parent:"@"},controller:["$scope",function(d){d.item={type:d.type},d.parent&&(d.item.parent=d.parent),d.getImage=function(){return Array.isArray(d.$root.uploadResult)&&d.$root.uploadResult.length?d.$root.uploadResult[0].path.split(/\//).pop():void 0},d.save=function(){var e={type:d.item.type,subject:d.item.subject,description:d.item.description,image:d.getImage()};if(d.parent&&(e.parent=d.parent),d.item.references){e.references=[];for(var f in d.item.references)e.references[+f]=d.item.references[f]}console.log("item",e),c.Item.create(e).success(function(c){a.items=[c].concat(a.items),d.$parent.show="items",b(function(){var b=angular.element("#item-"+c._id).scope();b.$apply(function(){b.$show="evaluator"}),a.itemViewed=c._id,a.lineage[c._id]=c.parent})})}}],link:function(a,b,c){c.$observe("subject",function(a){console.log("subject",a)})}}}b.exports=["$rootScope","$timeout","DataFactory",a]}()},{}],4:[function(a,b){!function(){function a(){return{restrict:"C",link:function(a){a.emailBody="I'm helping to bring synergy to democracy by voicing my opinion. I'm participating in the topic: \""+a.item.subject+'". Please join me at Synaccord '+location.href}}}b.exports=[a]}()},{}],5:[function(a,b){!function(){function a(a,b){return{restrict:"C",templateUrl:"/templates/editor",controller:["$scope",function(c){c.getImage=function(){return Array.isArray(c.$root.uploadResult)&&c.$root.uploadResult.length?c.$root.uploadResult[0].path.split(/\//).pop():void 0},c.save=function(){var d={type:c.item.type,subject:c.item.subject,description:c.item.description,image:c.getImage()||c.item.image};if(c.item.parent&&(d.parent=c.item.parent),c.item.references){d.references=[];for(var e in c.item.references)d.references[+e]=c.item.references[e]}console.log("item",d),a.Item.create(d).success(function(a){c.$root.items=[a].concat(c.$root.items),c.$parent.show="items",b(function(){var b=angular.element("#item-"+a._id).scope();b.$apply(function(){b.$show="evaluator"}),c.$root.itemViewed=a._id,c.$root.lineage[a._id]=a.parent})})}}]}}b.exports=["DataFactory","$timeout",a]}()},{}],6:[function(a,b){!function(){function a(a){return{restrict:"C",link:function(b,c){b.closeEvaluation=function(c){c||(a(function(){b.$show="-"},500),a(function(){b.$show="details"},1e3),a(function(){b.$root.evaluations=b.$root.evaluations.filter(function(a){return a.item!==b.item._id})},1e3))},b.editAndGoAgain=function(){b.$parent.show="creator",c.closest(".panel").find(".creator").attr("subject","hello")}}}}b.exports=["$timeout",a]}()},{}],7:[function(a,b){!function(){function c(){return{restrict:"C",scope:{url:"@",filter:"@",image:"@",upload:"@"},link:function(b,c){var d=a("../lib/youtube")(b.url);if(d)c.append(d);else if(b.image&&/cloudinary/.test(b.image)){var e=$("<img />");e.addClass("img-responsive"),e.attr("src",b.image),c.append(e)}else if(b.upload){var e=$("<img />");e.addClass("img-responsive"),e.attr("src",b.upload),c.append(e)}}}}b.exports=[c]}()},{"../lib/youtube":27}],8:[function(a,b){!function(){function a(a,b,c){return{restrict:"C",controller:["$scope",function(a){a.loaded={}}],link:function(a,d){a.isSplit=["Agree","Disagree","Pro","Con"].indexOf(a.item.type)>-1,b(function(){new c(d)})}}}b.exports=["$rootScope","$timeout","Truncate",a]}()},{}],9:[function(a,b){!function(){function c(a,b,c,d){function e(b){var e='<div  data-type    =   "'+b+'"  data-parent  =   "'+a._id+'" class        =   "navigator"></div>';return d(e)(c)}var f=synapp["item relation"][a.type];if(console.log(f),f){var g=$('<div class="row"></div>'),h=b.find(".children");Array.isArray(f)?f.forEach(function(a){if(Array.isArray(a)){var b=$('<div class="col-xs-6 split-view"></div>');b.append(e(a[0]));var c=$('<div class="col-xs-6 split-view"></div>');c.append(e(a[1])),g.append(b,c),h.append(g)}else h.append(e(a))}):h.append(e(f))}return!0}function d(b,d,e,f){return{restrict:"C",templateUrl:"/templates/navigator",scope:{type:" @",parent:"@"},controller:["$scope",function(g){g.batchSize=synapp["navigator batch size"],g.loadChildren=function(a){var e=b.items.reduce(function(b,c){return c._id===a&&(b=c),b},null),h=g.$new();c(e,$("#item-"+a),h,d),f.Item.find({parent:a}).success(function(a){b.items=b.items.concat(a),a.forEach(function(a){b.lineage[a._id]=a.parent})})},g.loadMore=function(){var c={type:g.type,$skip:g.batchSize};g.parent&&(c.parent=g.parent),f.Item.find(c).success(function(c){b.items=b.items.concat(c),c.forEach(function(a){b.lineage[a._id]=a.parent}),g.batchSize+=synapp["navigator batch size"],e(function(){a("../lib/ellipsis").apply(g.elem.find(".box"))})})}}],link:function(a,b){a.elem=b,a.$root.subscribe("load children",function(b){a.loadChildren(b.parent),b.view.removeClass("is-loading").addClass("is-loaded")})}}}b.exports=["$rootScope","$compile","$timeout","DataFactory",d]}()},{"../lib/ellipsis":26}],10:[function(a,b){!function(){function a(a){return{restrict:"C",templateUrl:"/templates/sign",scope:{},link:function(b){b.sign={},b.signByMail={},b.agreeToTerms=!1,b.signIn=function(){return b.sign.email?b.sign.password?a.signIn({email:b.sign.email.toLowerCase(),password:b.sign.password}).error(function(a){return a.error&&a.error.statusCode&&404===a.error.statusCode?b.alert="Invalid credentials":void(b.alert="An unexpected error has occurred. Please try again in a moment")}).success(function(){b.isSignedIn=!0,location.reload()}):void(b.alert="Please enter a password"):void(b.alert="Please enter a valid email")},b.signUp=function(c){return b.agreeToTerms?"facebook"===c?location.href="/auth/facebook":b.signByMail.email?b.signByMail.password?b.signByMail.confirm?b.signByMail.confirm!==b.signByMail.password?void(b.alert="Passwords don't match"):a.signUp({email:b.signByMail.email,password:b.signByMail.password}).error(function(a){return a.error&&a.error.message&&/duplicate/.test(a.error.message)?b.alert="This email address is already in use":void(b.alert="Something grrrr")}).success(function(){b.isSignedIn=!0,location.reload()}):void(b.alert="Please confirm password"):void(b.alert="Please enter a password"):void(b.alert="Please enter a valid email"):b.alert="You must agree to our terms of service"}}}}b.exports=["SignFactory",a]}()},{}],11:[function(a,b){!function(){function a(a){return{restrict:"C",templateUrl:"/templates/sliders",link:function(b,c){a(function(){c.find("input.slider").slider(),c.find("input.slider").slider("setValue",0),c.find("input.slider").slider("on","slideStop",function(){var a=$(this);if(a.attr("type")){var c=a.slider("getValue");b.$parent.evaluation.votes[b.item._id][a.data("criteria")]=c}})})}}}b.exports=["$timeout",a]}()},{}],12:[function(a,b){!function(){function c(b){return{restrict:"CA",link:function(c,d){c.searchingTitle=!1,d.on("change",function(){c.searchingTitle=!0,c.searchingTitleFailed=!1,$(this).data("changing","yes"),b.post("/tools/get-title",{url:$(this).val()}).error(function(){c.searchingTitleFailed=!0,c.searchingTitle=!1}).success(function(b){d.data("changing","no"),c.searchingTitle=!1,c.item.references[0].url=d.val(),c.item.references[0].title=b,d.data("url",c.item.references[0].url),d.data("title",c.item.references[0].title);var e=a("../lib/youtube")(c.item.references[0].url);e&&d.closest(".editor,.creator").find(".item-media").addClass("youtube").empty().append(e)})})}}}b.exports=["$http",c]}()},{"../lib/youtube":27}],13:[function(a,b){!function(){function a(a){function b(a,b){var d=[];b=b||{};var e=null;for(var f in b)isNaN(f)||(e=+f);null===e&&(b[c]=void 0);for(var g in b)d.push(void 0===b[g]?g:[g,b[g]].join("="));return a+="?"+d.join("&")}var c=synapp["navigator batch size"];return{Item:{find:function(c){return c["sort:promotions-,created-"]=void 0,a.get(b("/models/Item",c))},update:function(b,c){return a.put("/models/Item?_id="+b,c)},create:function(b){return a.post("/models/Item",b)},evaluate:function(b){return a.get("/models/Item.evaluate/"+b)},details:function(b){return a.get("/models/Item.details/"+b)}},Feedback:{find:function(c){return a.get(b("/models/Feedback",c))},create:function(b,c){return a.post("/models/Feedback",{feedback:c,item:b})}},Criteria:{find:function(c){return c[100]=void 0,c["sort:criteria+"]=void 0,a.get(b("/models/Criteria",c))}},Vote:{find:function(c){return a.get(b("/models/Vote",c))},create:function(b){return a.post("/models/Vote",b)}}}}b.exports=["$http",a]}()},{}],14:[function(a,b){!function(){function a(a){return{signIn:function(b){return a.post("/sign/in",b)},signUp:function(b){return a.post("/sign/up",b)}}}b.exports=["$http",a]}()},{}],15:[function(a,b){!function(){function a(a,b){function c(a){console.info("Truncating",a.attr("id")),this.item=a,this.description=this.item.find(".description"),this.textWrapper=this.item.find(".item-text"),this.reference=this.item.find(".reference"),this.text=this.description.text(),this.words=this.text.split(" "),this.height=parseInt(this.item.find(".item-text").css("paddingBottom")),this.truncated=!1,this.moreLabel="more",this.lessLabel="less",this.isIntro="intro"===this.item.attr("id"),this.isIntro||(this._id=this.item.attr("id").split("-")[1]),this.tagify(),this.truncated&&this.appendMoreButton()}return c.prototype.tagify=function(){var a=this;this.description.empty(),this.reference.hide();var b=0;this.words.forEach(function(c,d){var e=$("<span></span>");if(a.truncated&&(e.addClass("truncated"),e.hide()),e.text(c+" "),a.description.append(e),5===b){var f=a.textWrapper.height()>a.height;f&&!a.truncated&&d!==a.words.length-1&&(a.truncated=!0),b=-1}b++})},c.prototype.appendMoreButton=function(){var c=this;this.more=$('<span><i>... </i>[<a href=""></a>]</span>'),this.more.find("a").text(c.moreLabel),this.more.find("a").on("click",function(){var d=$(this);return c.item.find(".is-showing").length?!1:void b.scrollToPointOfAttention(c.item,function(){d.text()===c.moreLabel?c.isIntro?c.unTruncate():c.item.find(".is-shown").length?(a.publish("toggle view",{view:"text",item:c._id}),a.subscribe("did hide view",function(a){a.item===c._id&&setTimeout(function(){c.unTruncate()})})):c.unTruncate():c.reTruncate()})}),this.description.append(this.more)},c.prototype.unTruncate=function(){var a=this,b=0,c=50,c=Math.ceil(a.height/a.words.length);console.log(a.words.length,c);for(var d=0;d<this.words.length;d+=c)setTimeout(function(){for(var b=this.i+c,d=this.i;b>d;d++)a.item.find(".truncated:eq("+d+")").show()}.bind({i:d}),b+=1.5*c);setTimeout(function(){a.item.find(".reference").show(),a.more.find("a").text(a.lessLabel),a.more.find("i").hide()},b)},c.prototype.reTruncate=function(){for(var a=this,b=0,c=Math.ceil(a.height/a.words.length),d=0;d<this.words.length;d+=c)setTimeout(function(){for(var b=this.i+c,d=this.i;b>d;d++)a.item.find(".truncated:eq("+d+")").hide()}.bind({i:d}),b+=2*c);setTimeout(function(){a.item.find(".reference").hide(),a.more.find("a").text(a.moreLabel),a.more.find("i").show()},b)},c}b.exports=["$rootScope","View",a]}()},{}],16:[function(a,b){!function(){function a(){return{scrollToPointOfAttention:function(a,b){var c=a.offset().top-80,d=$(document).scrollTop();return 50>d-c?b():void $("html, body").animate({scrollTop:c},250,"swing",b)}}}b.exports=[a]}()},{}],17:[function(a,b){!function(){function a(){return function(a){return a?a.promotions?Math.floor(100*a.promotions/a.views):0:void 0}}b.exports=[a]}()},{}],18:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0}):void 0}}b.exports=[a]}()},{}],19:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0}):void 0}}b.exports=[a]}()},{}],20:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0}):void 0}}b.exports=[a]}()},{}],21:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){return a.item===b}):void 0}}b.exports=["$rootScope",a]}()},{}],22:[function(a,b){!function(){function a(a){return function(b,c){if(b&&c){var d=a.evaluations.reduce(function(a,b){return b.item===c&&(a=b),a},null);return d?d.items:[]}}}b.exports=["$rootScope",a]}()},{}],23:[function(a,b){!function(){function a(){return function(a,b,c){if(a){var d={};return b&&(d.type=b),c&&(d.parent=c),a.filter(function(a){for(var b in d)if(a[b]!==d[b])return!1;return!0})}}}b.exports=[a]}()},{}],24:[function(a,b){!function(){function a(){function a(a,b){if(a){if(b=b||100,a.length<b)return a;if(/\s/.test(a[b]))return a.substr(0,b);var c=a.substr(b).split(/\s/);return a.substr(0,b)+c[0]}}return a}b.exports=[a]}()},{}],25:[function(a){!function(){angular.module("synapp",["angularFileUpload","ngAnimate","autoGrow"]).factory({DataFactory:a("./factories/Data"),SignFactory:a("./factories/Sign"),Truncate:a("./factories/Truncate"),View:a("./factories/View")}).filter({shorten:a("./filters/shorten"),calculatePromotionPercentage:a("./filters/calculate-promotion-percentage"),getEvaluationItems:a("./filters/get-evaluation-items"),getEvaluationByItem:a("./filters/get-evaluation-by-item"),itemFilter:a("./filters/item-filter"),criteriaFilter:a("./filters/criteria-filter"),feedbackFilter:a("./filters/feedback-filter"),find:a("./filters/find")}).controller({UploadCtrl:a("./controllers/upload")}).directive({charts:a("./directives/charts"),creator:a("./directives/creator"),details:a("./directives/details"),editor:a("./directives/editor"),evaluator:a("./directives/evaluator"),item:a("./directives/item"),itemMedia:a("./directives/item-media"),navigator:a("./directives/navigator"),sign:a("./directives/sign"),sliders:a("./directives/sliders"),urlFetcher:a("./directives/url-fetcher")}).run(a("./run"))}()},{"./controllers/upload":1,"./directives/charts":2,"./directives/creator":3,"./directives/details":4,"./directives/editor":5,"./directives/evaluator":6,"./directives/item":8,"./directives/item-media":7,"./directives/navigator":9,"./directives/sign":10,"./directives/sliders":11,"./directives/url-fetcher":12,"./factories/Data":13,"./factories/Sign":14,"./factories/Truncate":15,"./factories/View":16,"./filters/calculate-promotion-percentage":17,"./filters/criteria-filter":18,"./filters/feedback-filter":19,"./filters/find":20,"./filters/get-evaluation-by-item":21,"./filters/get-evaluation-items":22,"./filters/item-filter":23,"./filters/shorten":24,"./run":28}],26:[function(a,b){!function(){return!1}()},{}],27:[function(a,b){!function(){function a(a){var b=/youtu\.?be.+v=([^&]+)/;if(a&&b.test(a)){var c;a.replace(b,function(a,b){c=b});var d=$("<div></div>");d.addClass("video-container");var e=$("<iframe></iframe>");return e.attr("src","http://www.youtube.com/embed/"+c),e.attr("frameborder","0"),e.attr("width",560),e.attr("height",315),d.append(e),d}return!1}b.exports=a}()},{}],28:[function(a,b){!function(){function a(a,b,c,d,e,f){function g(b){this.item=b.item,this.items=b.items,this.type=b.type,this.criterias=b.criterias,this.votes=[],this.cursor=1,this.limit=5,this.items.length<6&&(this.limit=this.items.length-1,this.limit||1!==this.items.length||(this.limit=1)),this.current=[],this.next=[];for(var c=[function(){this.current[0]=this.items.shift(),a.addViewToItem(this.current[0])}.bind(this),function(){this.current[1]=this.items.shift(),a.addViewToItem(this.current[1])}.bind(this),function(){this.next[0]=this.items.shift()}.bind(this),function(){this.next[1]=this.items.shift()}.bind(this)],d=0;c[d]&&b.items.length;)c[d](),d++}a.items=[],a.evaluations=[],a.feedbacks=[],a.votes=[],a.show={},a.loadedItems={},a.lineage={},a.$on("$locationChangeStart",function(){switch(b.path()){case"/intro":case"intro":$(window).scrollTop($("#intro").offset().top-100)}}),a.criterias=[],d.Criteria.find({}).success(function(b){a.criterias=b}),a.getItems=function(b){d.Item.find(b).success(function(c){a.items=a.items.concat(c),a.loadedItems[b.parent||b.type]=!0,c.forEach(function(b){a.lineage[b._id]=b.parent})}).error(function(){console.log(arguments)})},a.getItems({type:"Topic"}),a.addViewToItem=function(b){b&&(d.Item.update(b._id,{$inc:{views:1}}),a.items.forEach(function(c,d){c._id===b._id&&(a.items[d].views+=1)}))},a.addPromotionToItem=function(b){console.log("promoting"),d.Item.update(b._id,{$inc:{promotions:1}}),a.items.forEach(function(c,d){c._id===b._id&&(a.items[d].promotions+=1)})},a.itemHas=function(b,c){if(b&&c)for(var d=a.lineage[c];d;){if(d===b._id)return!0;d=a.lineage[d]}},g.prototype.change=function(b){if(b=b||"both",this.current[0]&&(this.current[0].$feedback&&(d.Feedback.create(this.current[0]._id,this.current[0].$feedback),a.items.forEach(function(b){b._id===this._id&&(this.$feedback.item=b._id,a.feedbacks.push(this.$feedback))}.bind(this.current[0]))),this.votes[this.current[0]._id])){var c=[];for(var e in this.votes[this.current[0]._id])c.push({item:this.current[0]._id,criteria:e,value:this.votes[this.current[0]._id][e]});if(c.length){d.Vote.create(c);var f=!1;if(a.votes.forEach(function(a,b){console.warn(a,this._id,b),a.item===this._id&&(f=b)}.bind(this.current[0])),console.error("watch out",f,f!==!1),f!==!1){console.warn(a.votes,f);for(var e in this.votes[this.current[0]._id])a.votes[f].criterias[e].total++,a.votes[f].criterias[e].values[this.votes[this.current[0]._id][e]]++}}}if(this.current[1]&&(this.current[1].$feedback&&(d.Feedback.create(this.current[1]._id,this.current[1].$feedback),a.items.forEach(function(b){b._id===this._id&&(this.$feedback.item=b._id,a.feedbacks.push(this.$feedback))}.bind(this.current[1]))),this.votes[this.current[1]._id])){console.info("votes detected");var c=[];for(var e in this.votes[this.current[1]._id])c.push({item:this.current[1]._id,criteria:e,value:this.votes[this.current[1]._id][e]});if(c.length){var f=!1;a.votes.forEach(function(a,b){a.item===this._id&&(f=b)}.bind(this.current[1])),d.Vote.create(c).success(function(){if(f!==!1)for(var b in this)a.votes[f].criterias[b].total++,a.votes[f].criterias[b].values[this[b]]++}.bind(this.votes[this.current[1]._id]))}}this.next.length?(("left"===b||"both"===b)&&(this.current[0]=this.next.shift(),a.addViewToItem(this.current[0])),("right"===b||"both"===b)&&(this.next.length?(this.current[1]=this.next.shift(),a.addViewToItem(this.current[1])):this.current.splice(1,1)),"both"===b&&(this.items.length&&this.next.push(this.items.shift()),this.cursor!==this.limit&&this.cursor++),this.items.length&&this.next.push(this.items.shift()),this.cursor!==this.limit&&this.cursor++):this.current=[]},g.prototype.continue=function(){this.change()},g.prototype.finish=function(){this.change()},g.prototype.promote=function(b){0===b?(a.addPromotionToItem(this.current[0]),this.change("right")):(a.addPromotionToItem(this.current[1]),this.change("left"))},a.loadEvaluation=function(b){var c=a.evaluations.filter(function(a){return a.item===b});return c.length?void 0:d.Item.evaluate(b).success(function(b){a.evaluations.push(new g(b))})},a.loadDetails=function(b){d.Item.details(b).success(function(c){console.log("details",c);var d=c.feedbacks;a.feedbacks.length&&(d=d.filter(function(b){return a.feedbacks.some(function(a){return a._id===b._id})})),a.feedbacks=a.feedbacks.concat(d);var e={item:b,criterias:c.votes};a.votes=a.votes.filter(function(a){return a.item!==b}),a.votes.push(e)})},d.Item.find({type:"Intro"}).success(function(b){a.intro=b[0],c(function(){new e($("#intro"))})}),a.__channels={},a.publish=function(b,c){a.__channels[b]&&a.__channels[b].forEach(function(a){a(c)})},a.subscribe=function(b,c){a.__channels[b]||(a.__channels[b]=[]),a.__channels[b].push(c)},a.subscribe("toggle view",function(b){function c(c,d){c.css("margin-top","-"+c.height()+"px"),c.find(".is-section:first").animate({"margin-top":0},750,function(){c.removeClass("is-showing").addClass("is-shown"),a.publish("did show view",b),d&&d()}),c.animate({opacity:1},700)}function d(c,d){c.removeClass("is-shown").addClass("is-hiding"),c.find(".is-section:first").animate({"margin-top":"-"+c.height()+"px"},750,function(){c.removeClass("is-hiding").addClass("is-hidden"),a.publish("did hide view",b),d&&d()}),c.animate({opacity:0},750)}console.log("toggle view",b);var e=$("#item-"+b.item).find("."+b.view);if($("#item-"+b.item).hasClass(".is-showing"))return!1;e.hasClass("is-toggable")||e.addClass("is-toggable");var g=$("#item-"+b.item).offset().top,h=$(window).scroll();console.log({item:g,scroll:h}),f.scrollToPointOfAttention($("#item-"+b.item),function(){if(e.hasClass("is-shown"))d(e);else switch($("#item-"+b.item).find(".is-shown").length?d($("#item-"+b.item).find(".is-shown"),function(){e.removeClass("is-hidden").addClass("is-showing"),setTimeout(function(){c(e)})}):(e.removeClass("is-hidden").addClass("is-showing"),setTimeout(function(){c(e)})),b.view){case"evaluator":e.hasClass("is-loaded")||a.loadEvaluation(b.item).success(function(){e.addClass("is-loaded")});break;case"children":e.hasClass("is-loaded")||e.hasClass("is-loading")||a.publish("load children",{parent:b.item,view:e})}})})}b.exports=["$rootScope","$location","$timeout","DataFactory","Truncate","View",a]}()},{}]},{},[25]);