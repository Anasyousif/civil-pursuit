!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){!function(){var a={debug:!0},c="/tools/upload";window.uploadUrl=window.uploadUrl||"upload";var d=["$rootScope","$scope","$http","$timeout","$upload",function(b,d,e,f,g){d.howToSend=1,d.usingFlash=a&&null!=a.upload,d.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=a.html5),d.uploadRightAway=!0,d.hasUploader=function(a){return null!=d.upload[a]},d.abort=function(a){d.upload[a].abort(),d.upload[a]=null},d.onFileSelect=function(a){if(d.selectedFiles=[],d.progress=[],d.upload&&d.upload.length>0)for(var c=0;c<d.upload.length;c++)null!=d.upload[c]&&d.upload[c].abort();d.upload=[],d.uploadResult=[],b.uploadResult=d.uploadResult,d.selectedFiles=a,d.dataUrls=[],b.dataUrls=d.dataUrls;for(var c=0;c<a.length;c++){var e=a[c];if(d.fileReaderSupported&&e.type.indexOf("image")>-1){var g=new FileReader;g.readAsDataURL(a[c]);{(function(a,b){a.onload=function(a){f(function(){d.dataUrls[b]=a.target.result})}})(g,c)}}d.progress[c]=-1,d.uploadRightAway&&d.start(c)}},d.start=function(a){if(d.progress[a]=0,d.errorMsg=null,1==d.howToSend)d.upload[a]=g.upload({url:c,method:d.httpMethod,headers:{"my-header":"my-header-value"},data:{myModel:d.myModel},file:d.selectedFiles[a],fileFormDataName:"myFile"}),d.upload[a].then(function(a){f(function(){d.uploadResult.push(a.data)})},function(a){a.status>0&&(d.errorMsg=a.status+": "+a.data)},function(b){d.progress[a]=Math.min(100,parseInt(100*b.loaded/b.total))}),d.upload[a].xhr(function(a){a.upload.addEventListener("abort",function(){console.log("abort complete")},!1)});else{var b=new FileReader;b.onload=function(b){d.upload[a]=g.http({url:c,headers:{"Content-Type":d.selectedFiles[a].type},data:b.target.result}).then(function(a){d.uploadResult.push(a.data)},function(a){a.status>0&&(d.errorMsg=a.status+": "+a.data)},function(b){d.progress[a]=Math.min(100,parseInt(100*b.loaded/b.total))})},b.readAsArrayBuffer(d.selectedFiles[a])}},d.dragOverClass=function(a){var b=a.dataTransfer.items,c=!1;if(null!=b){for(var d=0;d<b.length;d++)if("file"==b[d].kind){c=!0;break}}else c=!0;return c?"dragover":"dragover-err"}}];b.exports=d}()},{}],2:[function(a,b){!function(){function a(a,b,c){return{restrict:"C",templateUrl:"/templates/editor",scope:{type:"@",parent:"@"},controller:["$scope",function(d){d.item={type:d.type},d.parent&&(d.item.parent=d.parent),d.getImage=function(){return Array.isArray(d.$root.uploadResult)&&d.$root.uploadResult.length?d.$root.uploadResult[0].path.split(/\//).pop():void 0},d.save=function(){var e={type:d.item.type,subject:d.item.subject,description:d.item.description,image:d.getImage()};if(d.parent&&(e.parent=d.parent),d.item.references){e.references=[];for(var f in d.item.references)e.references[+f]=d.item.references[f]}console.log("item",e),c.Item.create(e).success(function(c){a.items=[c].concat(a.items),d.$parent.show="items",b(function(){var b=angular.element("#item-"+c._id).scope();b.$apply(function(){b.$show="evaluator"}),a.itemViewed=c._id,a.lineage[c._id]=c.parent})})}}]}}b.exports=["$rootScope","$timeout","DataFactory",a]}()},{}],3:[function(a,b){!function(){function a(a){return{restrict:"C",templateUrl:"/templates/editor",controller:["$scope",function(b){b.save=function(){a.Item.update(b.item._id,{subject:b.item.subject,description:b.item.description,image:function(){return Array.isArray(b.$root.uploadResult)&&b.$root.uploadResult.length?b.$root.uploadResult[0].path.split(/\//).pop():void 0}()})}}]}}b.exports=["DataFactory",a]}()},{}],4:[function(a,b){!function(){function a(a){return{restrict:"C",link:function(b){b.closeEvaluation=function(c){c||(a(function(){b.$show="-"},500),a(function(){b.$show="details"},1e3))}}}}b.exports=["$timeout",a]}()},{}],5:[function(a,b){!function(){function a(){return{restrict:"C",scope:{url:"@",filter:"@",image:"@",upload:"@"},link:function(a,b){var c=/youtu\.?be.+v=([^&]+)/;if(a.url&&c.test(a.url)){var d;a.url.replace(c,function(a,b){d=b});var e=$("<div></div>");e.addClass("video-container");var f=$("<iframe></iframe>");f.attr("src","http://www.youtube.com/embed/"+d),f.attr("frameborder","0"),f.attr("width",560),f.attr("height",315),e.append(f),b.append(e)}else if(a.image&&/cloudinary/.test(a.image)){var g=$("<img />");g.addClass("img-responsive"),g.attr("src",a.image),b.append(g)}else if(a.upload){var g=$("<img />");g.addClass("img-responsive"),g.attr("src",a.upload),b.append(g)}}}}b.exports=[a]}()},{}],6:[function(a,b){!function(){function a(){return{restrict:"C",controller:["$scope",function(a){a.loaded={},a.$watch("$show",function(b,c){if(b&&b!==c&&(console.log("show",b,a.loaded[b]),!a.loaded[b]))switch(b){case"children":a.loaded.children=!0,a.$parent.loadChildren(a.item._id);break;case"evaluator":a.loaded.evaluator=!0,a.$root.loadEvaluation(a.item._id);break;case"details":a.loaded.details=!0,a.$root.loadDetails(a.item._id)}})}],link:function(a){a.isSplit=["Agree","Disagree","Pro","Con"].indexOf(a.item.type)>-1}}}b.exports=["$rootScope",a]}()},{}],7:[function(a,b){!function(){function a(a,b,c,d){function e(b){var e='<div  data-type    =   "'+b+'"  data-parent  =   "'+a._id+'" class        =   "navigator"></div>';return d(e)(c)}var f=synapp["item relation"][a.type];if(console.log(f),f){var g=$('<div class="row"></div>'),h=b.find(".children");Array.isArray(f)?f.forEach(function(a){if(Array.isArray(a)){var b=$('<div class="col-xs-6 split-view"></div>');b.append(e(a[0]));var c=$('<div class="col-xs-6 split-view"></div>');c.append(e(a[1])),g.append(b,c),h.append(g)}else h.append(e(a))}):h.append(e(f))}return!0}function c(b,c,d){return{restrict:"C",templateUrl:"/templates/navigator",scope:{type:" @",parent:"@"},controller:["$scope",function(e){e.loadChildren=function(f){var g=b.items.reduce(function(a,b){return b._id===f&&(a=b),a},null),h=e.$new();a(g,$("#item-"+f),h,c),d.Item.find({parent:f}).success(function(a){b.items=b.items.concat(a),a.forEach(function(a){b.lineage[a._id]=a.parent})})}}],link:function(){}}}b.exports=["$rootScope","$compile","DataFactory",c]}()},{}],8:[function(a,b){!function(){function a(a){return{restrict:"C",templateUrl:"/templates/sign",scope:{},link:function(b){b.sign={},b.signByMail={},b.agreeToTerms=!1,b.signIn=function(){return b.sign.email?b.sign.password?a.signIn({email:b.sign.email.toLowerCase(),password:b.sign.password}).error(function(a){return a.error&&a.error.statusCode&&404===a.error.statusCode?b.alert="Invalid credentials":void(b.alert="An unexpected error has occurred. Please try again in a moment")}).success(function(){b.isSignedIn=!0,location.reload()}):void(b.alert="Please enter a password"):void(b.alert="Please enter a valid email")},b.signUp=function(c){return b.agreeToTerms?"facebook"===c?location.href="/auth/facebook":b.signByMail.email?b.signByMail.password?b.signByMail.confirm?b.signByMail.confirm!==b.signByMail.password?void(b.alert="Passwords don't match"):a.signUp({email:b.signByMail.email,password:b.signByMail.password}).error(function(a){return a.error&&a.error.message&&/duplicate/.test(a.error.message)?b.alert="This email address is already in use":void(b.alert="Something grrrr")}).success(function(){b.isSignedIn=!0,location.reload()}):void(b.alert="Please confirm password"):void(b.alert="Please enter a password"):void(b.alert="Please enter a valid email"):b.alert="You must agree to our terms of service"}}}}b.exports=["SignFactory",a]}()},{}],9:[function(a,b){!function(){function a(a){return{restrict:"C",templateUrl:"/templates/sliders",link:function(b){b.enableSlider=function(b,c){b&&($("input.slider").slider(),$("input.slider").slider("setValue",5),c=5,$("input.slider").slider("on","slideStop",function(){var b=$(this);if(b.attr("type")){var c=a.items.reduce(function(a,c){return c._id===b.data("item")&&(a=c),a},{});c.$votes||(c.$votes={}),c.$votes[b.data("criteria")]=b.slider("getValue")}}))}}}}b.exports=["$rootScope",a]}()},{}],10:[function(a,b){function c(a){return{restrict:"CA",link:function(b,c){b.searchingTitle=!1,c.on("change",function(){b.searchingTitle=!0,b.searchingTitleFailed=!1,$(this).data("changing","yes"),a.post("/tools/get-title",{url:$(this).val()}).error(function(){b.searchingTitleFailed=!0,b.searchingTitle=!1}).success(function(a){c.data("changing","no"),b.searchingTitle=!1,b.item.references[0].url=c.val(),b.item.references[0].title=a,c.data("url",b.item.references[0].url),c.data("title",b.item.references[0].title)})})}}}b.exports=["$http",c]},{}],11:[function(a,b){!function(){function a(a){function b(a,b){var d=[];b=b||{},b[c]=void 0,b["sort:promotions-,created-"]=void 0;for(var e in b)d.push(void 0===b[e]?e:[e,b[e]].join("="));return a+="?"+d.join("&")}var c=synapp["navigator batch size"];return{Item:{find:function(c){return a.get(b("/models/Item",c))},update:function(b,c){return a.put("/models/Item?_id="+b,c)},create:function(b){return a.post("/models/Item",b)},evaluate:function(b){return a.get("/models/Item.evaluate/"+b)}},Feedback:{find:function(c){return a.get(b("/models/Feedback",c))},create:function(b,c){return a.post("/models/Feedback",{feedback:c,item:b})}},Criteria:{find:function(c){return a.get(b("/models/Criteria",c))}}}}b.exports=["$http",a]}()},{}],12:[function(a,b){!function(){function a(a){return{signIn:function(b){return a.post("/sign/in",b)},signUp:function(b){return a.post("/sign/up",b)}}}b.exports=["$http",a]}()},{}],13:[function(a,b){!function(){function a(){return function(a){return a?a.promotions?Math.floor(100*a.promotions/a.views):0:void 0}}b.exports=[a]}()},{}],14:[function(a,b){!function(){function a(){return function(a,b,c){if(a){var d={};return b&&(d.type=b),c&&(d.parent=c),a.filter(function(a){for(var b in d)if(a[b]!==d[b])return!1;return!0})}}}b.exports=[a]}()},{}],15:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){return a.item===b}):void 0}}b.exports=["$rootScope",a]}()},{}],16:[function(a,b){!function(){function a(a){return function(b,c){if(b&&c){var d=a.evaluations.reduce(function(a,b){return b.item===c&&(a=b),a},null);return d?d.items:[]}}}b.exports=["$rootScope",a]}()},{}],17:[function(a,b){!function(){function a(){return function(a,b){return a?a.filter(function(a){return a.item===b}):void 0}}b.exports=[a]}()},{}],18:[function(a,b){!function(){function a(){function a(a,b){return a?a.substr(0,b):void 0}return a}b.exports=[a]}()},{}],19:[function(a){!function(){angular.module("synapp",["angularFileUpload","ngAnimate"]).factory({DataFactory:a("./factories/Data"),SignFactory:a("./factories/Sign")}).filter({shorten:a("./filters/shorten"),calculatePromotionPercentage:a("./filters/calculate-promotion-percentage"),getEvaluationItems:a("./filters/get-evaluation-items"),getEvaluationByItem:a("./filters/get-evaluation-by-item"),getFeedbacksByItem:a("./filters/get-feedbacks-by-item"),filterItems:a("./filters/filter-items"),criteriaFilter:function(){return function(a,b){return a?a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0}):void 0}}}).controller({UploadCtrl:a("./controllers/upload")}).directive({sign:a("./directives/sign"),navigator:a("./directives/navigator"),item:a("./directives/item"),creator:a("./directives/creator"),evaluator:a("./directives/evaluator"),urlFetcher:a("./directives/url-fetcher"),editor:a("./directives/editor"),itemMedia:a("./directives/item-media"),sliders:a("./directives/sliders")}).config(["$locationProvider",function(){}]).run(a("./run"))}()},{"./controllers/upload":1,"./directives/creator":2,"./directives/editor":3,"./directives/evaluator":4,"./directives/item":6,"./directives/item-media":5,"./directives/navigator":7,"./directives/sign":8,"./directives/sliders":9,"./directives/url-fetcher":10,"./factories/Data":11,"./factories/Sign":12,"./filters/calculate-promotion-percentage":13,"./filters/filter-items":14,"./filters/get-evaluation-by-item":15,"./filters/get-evaluation-items":16,"./filters/get-feedbacks-by-item":17,"./filters/shorten":18,"./run":20}],20:[function(a,b){!function(){function a(a,b,c){function d(b){this.item=b.item,this.items=b.items,this.type=b.type,this.criterias=b.criterias,this.cursor=1,this.limit=5,this.items.length<6&&(this.limit=this.items.length-1,this.limit||1!==this.items.length||(this.limit=1)),this.current=[],this.next=[];for(var c=[function(){var b=this.items.shift();this.current[0]=a.items.reduce(function(a,c){return c._id===b._id&&(a=c),a},null),a.addViewToItem(this.current[0])}.bind(this),function(){this.current[1]=this.items.shift(),a.addViewToItem(this.current[1])}.bind(this),function(){this.next[0]=this.items.shift()}.bind(this),function(){this.next[1]=this.items.shift()}.bind(this)],d=0;c[d]&&b.items.length;)c[d](),d++}a.items=[],a.evaluations=[],a.feedbacks=[],a.votes=[],a.show={},a.loadedItems={},a.lineage={},a.$on("$locationChangeStart",function(){switch(b.path()){case"/intro":case"intro":$(window).scrollTop($("#intro").offset().top-100)}}),a.criterias=[],c.Criteria.find({}).success(function(b){a.criterias=b}),a.getItems=function(b){c.Item.find(b).success(function(c){a.items=a.items.concat(c),a.loadedItems[b.parent||b.type]=!0,c.forEach(function(b){a.lineage[b._id]=b.parent})}).error(function(){console.log(arguments)})},a.getItems({type:"Topic"}),a.addViewToItem=function(b){b&&(c.Item.update(b._id,{$inc:{views:1}}),a.items.forEach(function(c,d){c._id===b._id&&(a.items[d].views+=1)}))},a.addPromotionToItem=function(b){console.log("promoting"),c.Item.update(b._id,{$inc:{promotions:1}}),a.items.forEach(function(c,d){c._id===b._id&&(a.items[d].promotions+=1)})},a.itemHas=function(b,c){if(b&&c)for(var d=a.lineage[c];d;){if(d===b._id)return!0;d=a.lineage[d]}},d.prototype.change=function(b){b=b||"both",this.current[0]&&this.current[0].$feedback&&c.Feedback.create(this.current[0]._id,this.current[0].$feedback),this.current[1]&&this.current[1].$feedback&&c.Feedback.create(this.current[1]._id,this.current[1].$feedback),this.next.length?(("left"===b||"both"===b)&&(this.current[0]=this.next.shift(),a.addViewToItem(this.current[0])),("right"===b||"both"===b)&&(this.next.length?(this.current[1]=this.next.shift(),a.addViewToItem(this.current[1])):this.current.splice(1,1)),"both"===b&&(this.items.length&&this.next.push(this.items.shift()),this.cursor!==this.limit&&this.cursor++),this.items.length&&this.next.push(this.items.shift()),this.cursor!==this.limit&&this.cursor++):this.current=[]},d.prototype.continue=function(){this.change()},d.prototype.finish=function(){this.change()},d.prototype.promote=function(b){0===b?(a.addPromotionToItem(this.current[0]),this.change("right")):(a.addPromotionToItem(this.current[1]),this.change("left"))},a.loadEvaluation=function(b){var e=a.evaluations.filter(function(a){return a.item===b});e.length||c.Item.evaluate(b).success(function(b){a.evaluations.push(new d(b))})},a.loadDetails=function(b){var d=a.feedbacks.filter(function(a){return a.item===b});d.length||c.Feedback.find({item:b}).success(function(b){a.feedbacks=a.feedbacks.concat(b)})}}b.exports=["$rootScope","$location","DataFactory",a]}()},{}]},{},[19]);