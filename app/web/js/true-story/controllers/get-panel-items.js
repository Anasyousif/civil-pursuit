/***


         @\_______/@
        @|XXXXXXXX |
       @ |X||    X |
      @  |X||    X |
     @   |XXXXXXXX |
    @    |X||    X |             V
   @     |X||   .X |
  @      |X||.  .X |                      V
 @      |%XXXXXXXX%||
@       |X||  . . X||
        |X||   .. X||                               @     @
        |X||  .   X||.                              ||====%
        |X|| .    X|| .                             ||    %
        |X||.     X||   .                           ||====%
       |XXXXXXXXXXXX||     .                        ||    %
       |XXXXXXXXXXXX||         .                 .  ||====% .
       |XX|        X||                .        .    ||    %  .
       |XX|        X||                   .          ||====%   .
       |XX|        X||              .          .    ||    %     .
       |XX|======= X||============================+ || .. %  ........
===== /            X||                              ||    %
                   X||           /)                 ||    %
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Nina Butorac

                                                                             
                            
                                                                             
 $$$$$$$  $$    $$  $$$$$$$    $$$$$$    $$$$$$    $$$$$$      $$   $$$$$$$  
$$        $$    $$  $$    $$        $$  $$    $$  $$    $$         $$        
 $$$$$$   $$    $$  $$    $$   $$$$$$$  $$    $$  $$    $$     $$   $$$$$$   
      $$  $$    $$  $$    $$  $$    $$  $$    $$  $$    $$     $$        $$  
$$$$$$$    $$$$$$$  $$    $$   $$$$$$$  $$$$$$$   $$$$$$$      $$  $$$$$$$   
                $$                      $$        $$           $$            
          $$    $$                      $$        $$     $$    $$            
           $$$$$$                       $$        $$      $$$$$$             




               .. ..oooo.....ooo...
            .odSS4PYYYSSOOXXXXXXXXXOodbgooo.
           /SSYod$$$$SSOIIPXXXXXXXXXYYP.oo.*b.
          ($$Yd$$$$SSSOII:XXXXXXXX:IIoSSS$$b.Y,
           \Yd$$$$SSSOII:XXXXXXXXXX:IIOOSSS$$$b\
            d$$$$SSSOOI:XP"YXXXXXXXX:IIOOSSSS$$$\
            Y$$$SSSOOII:XbdXXXXXP"YX:IIOOOSS$$$$)
            'Y$$$SSSOI:XXXXXXXXXbodX:IIOOSS$$$$$/
             "Y$$$SSSOI(PoTXXXXXTo)XXIIOOOSS$$$*'
               ""*Y$S(((PXXXXXXXY))dIIOSSS$$dP'
                  "*'()P;XXXXXXXXY)IIOSSS$P".oS,
                  (S'(P;XXXXXXXP;Y)XXYOP".oSSSSb
                 (S'(P;'XXXXXXX';Y).ooooSSSSSSSS)
                 (S'(P;'XXXXXXP';Y).oSSSSSSSSSSSP
                 (SS'Y);YXXXXX';(Y.oSSSSSSSSSSSSP
                  YSS'Y)'YXXX".(Y.oSSP.SSSSSSSSY
                   YSS'"" XXX""oooSSP.SSSSSSSSY
                   SSSSSS YXXX:SSSSP.SSSSSSSSY
                   SSSSSP  YXb:SSSP.S"SSSSSSP
                   S(OO)S   YXb:SY    )SSSSS
                   SSSSO    )YXb.I    ISSSSP
                   YSSSY    I."YXXb   Y(SS)I
                   )SSS(    dSSo.""*b  YSSSY
                   OooSb   dSSSSP      )SSS(
                           dSSSY       OooSS
                           OooSP


                                   __                          __         
                                  /  |                        /  |        
    _______   ______   _______   _$$ |_     ______    ______  $$ |        
   /       | /      \ /       \ / $$   |   /      \  /      \ $$ | ______ 
  /$$$$$$$/ /$$$$$$  |$$$$$$$  |$$$$$$/   /$$$$$$  |/$$$$$$  |$$ |/      |
  $$ |      $$ |  $$ |$$ |  $$ |  $$ | __ $$ |  $$/ $$ |  $$ |$$ |$$$$$$/ 
  $$ \_____ $$ \__$$ |$$ |  $$ |  $$ |/  |$$ |      $$ \__$$ |$$ |        
  $$       |$$    $$/ $$ |  $$ |  $$  $$/ $$ |      $$    $$/ $$ |        
   $$$$$$$/  $$$$$$/  $$/   $$/    $$$$/  $$/        $$$$$$/  $$/         
                                                                          
                                                                              
                           __                               
                          /  |                              
                          $$ |  ______    ______  
                   ______ $$ | /      \  /      \ 
                  /      |$$ |/$$$$$$  |/$$$$$$  |
                  $$$$$$/ $$ |$$    $$ |$$ |  $$/ 
                          $$ |$$$$$$$$/ $$ |      
                          $$ |$$       |$$ |      
                          $$/  $$$$$$$/ $$/       
                                      
                                      
                                      


                                          
                                                    
                                            $$      
                                            $$      
                       $$$$$$    $$$$$$   $$$$$$    
                      $$    $$  $$    $$    $$      
                      $$    $$  $$$$$$$$    $$      
                      $$    $$  $$          $$  $$  
                       $$$$$$$   $$$$$$$     $$$$   
                            $$                      
                      $$    $$                      
                       $$$$$$                       

                                                       
                                                            
                                                        $$  
                                                        $$  
                 $$$$$$    $$$$$$   $$$$$$$    $$$$$$   $$  
                $$    $$        $$  $$    $$  $$    $$  $$  
                $$    $$   $$$$$$$  $$    $$  $$$$$$$$  $$  
                $$    $$  $$    $$  $$    $$  $$        $$  
                $$$$$$$    $$$$$$$  $$    $$   $$$$$$$  $$  
                $$                                          
                $$                                          
                $$                                          

                                                          
                                                                
                $$    $$                                        
                      $$                                        
                $$  $$$$$$     $$$$$$   $$$$$$ $$$$    $$$$$$$  
                $$    $$      $$    $$  $$   $$   $$  $$        
                $$    $$      $$$$$$$$  $$   $$   $$   $$$$$$   
                $$    $$  $$  $$        $$   $$   $$        $$  
                $$     $$$$    $$$$$$$  $$   $$   $$  $$$$$$$   
                                                                
                                                                


***/

; ! function () {

  'use strict';

  function gotPanels (panelItems) {
    console.info(new (function synapp_got_panel_items () {})());
    
    var app = this;

    app.model('items').concat(panelItems.items);

    var id = '#panel-' + panelItems.panel.type;

    if ( panelItems.panel.parent ) {
      id += '-' + panelItems.panel.parent;
    }

    app.controller('true-story/render-view')({
      container:  $(id).find('.items'),
      template:   {
        url: '/partial/item'
      },
      engine:     function (view, locals) {
        view = $(view);

        // app.controller('bind panel')(locals.panel, view);

        return view;
      },
      locals:     { items: panelItems.items },
      append:     true
    });
  }

  module.exports = function getPanelItems (panel) {

    console.info(new (function synapp_getting_panel_items () {})());

    this.emitter('socket').emit('get panel items', panel, {
      limit: synapp["navigator batch size"] });

    this.emitter('socket').on('got panel items', gotPanels.bind(this));

  };

} ();
